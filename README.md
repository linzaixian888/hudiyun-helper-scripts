## 狐蒂云自动抢购 - 使用说明

### 检测模式

- 全天候检测（all_day）
  - 进入或切换到该模式后，开始时间自动设为当前时间，结束时间输入被隐藏。
  - 0-24 小时持续检测配置的商品 ID；发现可购立即点击购买。
  - 连续未发现商品会累计失败次数，达到阈值（默认 5 次）后自动刷新页面再继续。
  - 面板状态显示“全天候(运行中)”，倒计时区域固定提示“全天候：0-24点”。
  - 进入支付页自动暂停；进入购物车页自动勾选并提交，提交后自动暂停。

- 平时三时间段（three_periods）
  - 每天在 3 个时间窗口内运行：7:00-9:00、13:00-14:00、17:00-19:00。
  - 窗口外：面板显示“等待三时间段”，倒计时显示距下个窗口开始的时间。
  - 窗口内：状态“抢购中(三段)”，倒计时显示距本窗口结束的时间；执行检测与自动下单。
  - 连续未发现商品达到阈值（默认 5 次）会自动刷新页面；一个窗口结束会自动等待下个窗口。

### 页面识别与通用检测

- 特殊页面
  - 支付页：自动暂停（不执行操作）。
  - 购物车页：自动勾选支付/条款并提交订单，提交后自动暂停。
  - 保护页（如配置页）：不刷新，仅尝试必要操作。

- 通用检测（不依赖特定 URL）
  - 只要页面存在“商品卡 + 按钮”，就会尝试检测与点击：
    - 直接匹配按钮链接中的 pid/gid：`.form-footer-butt[href*="pid=ID"], a[href*="gid=ID"]`。
    - 兼容容器属性：`[data-id="ID"]` 或 `[data-gid="ID"]` 内的按钮。

### 配置与存储

- 所有配置与运行状态持久化在浏览器 localStorage：
  - 配置：`hudiyun_config`
  - 运行状态（开始/暂停）：`hudiyun_running`
- 模式为圆点单选，切换即自动保存；其它配置点击“保存”写入，并在非保护页自动刷新生效。

### 关键参数

- 检测间隔（ms）：默认 800，可在面板调整。
- 自动刷新阈值（次）：默认 5。以“检测次数”计数，不是秒数。
  - 例：阈值=5、间隔=1000ms 时，第一次检测在 t=0 触发计数，所以约在 ~4.5s 左右刷新（包含一次刷新延时）。

### 常见问题

- 看不到自动检测/点击？
  - 打开控制台检查是否存在以下元素之一：
    - `document.querySelector('.form-footer-butt[href*="pid=目标ID"]')`
    - `document.querySelector('[data-id="目标ID"] .form-footer-butt')`
    - `document.querySelector('a[href*="gid=目标ID"]')`


- 有时候购物车会产生重复订单，这时需要人工手动删除，直到剩下一个，然后直接到支付页开脚本等着

---

## 狐蒂云识别商品页 - 使用说明

### 功能简介

自动在指定 PID 范围内扫描狐蒂云商品页，识别有效的商品配置页面，并记录成功的商品 ID。

### 使用方法

1. **设置扫描范围**
   - 起始 PID：要扫描的第一个商品 ID
   - 结束 PID：要扫描的最后一个商品 ID
   - 检查间隔：每个页面检查的间隔时间（毫秒）

2. **开始扫描**
   - 点击"开始"按钮开始自动扫描
   - 脚本会自动跳转到每个 PID 的页面进行检查
   - 识别成功的 PID 会自动记录并显示在列表中

3. **查看结果**
   - 成功的 ID 会实时显示在面板中
   - 点击"复制"按钮可复制所有成功 ID（逗号分隔）
   - 点击"清空"按钮可清除所有记录

### 识别逻辑

脚本通过检测以下元素判断页面是否为有效的商品页：

**成功的特征：**
- 包含产品名称或标题
- 有"周期"选择按钮组
- 有配置选择器（CPU、内存等）
- 有"加入购物车"按钮

**失败的特征：**
- 显示多个地区导航菜单
- 页面为空或显示错误信息

### 配置与存储

- 配置存储在 `localStorage`: `hudiyun_scanner_config`
- 成功 ID 列表存储在 `localStorage`: `hudiyun_scanner_success`
- 修改配置后自动保存
- 脚本关闭后重新打开会保留之前的成功记录


